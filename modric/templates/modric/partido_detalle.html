{% extends 'base.html' %}
{% block content %}
    <style>
#ficha-jugador {
    display: flex;
    align-items: center;
}

#ficha-jugador img {
    margin-right: 10px; /* Ajusta el espacio entre la imagen y el texto */
}
</style>
<div class="container mt-4">
    <h1 class="mb-4">Detalle partido</h1>
    
    {% if partido %}
        <div class="mb-3">
            {% if edicion == True %}
                <a href="{% url 'modric:editar_partido' partido.pk %}" class="btn btn-primary">Editar</a>
            {% endif %}
        </div>
        <div class="row">
            <div class="col-sm-2">
                <strong>Deporte:</strong> {{ partido.deporte }}
            </div>
            <div class="col">
                <strong>Fecha:</strong> {{ partido.fecha|date:"l"|capfirst }}, {{ partido.fecha }}
            </div>
            <div class="col-sm-2">
                <strong>Duración:</strong> {{ partido.duracion_personalizada }} minutos
            </div>
            <div class="col-sm-2">
                <strong>Recinto:</strong> <a href="{% url 'modric:recinto' partido.recinto.pk %}">{{ partido.recinto }}</a>
            </div>
            {% if partido.nombre_pista %}
                <div class="col-sm-2">
                        <strong>Número de pista:</strong> {{ partido.nombre_pista }}
                </div>
            {% endif %}
            <div class="col-sm-2">
                {% if partido.cubierto %}
                    <span class="badge bg-success">Pista cubierta</span>
                {% else %}
                    <span class="badge bg-warning">Pista al aire libre</span>
                {% endif %}
            </div>
        </div>
        <hr>
        
        <div class="custom-flex mb-3">
            <div>
                {% if administradores %}
                    <p><strong>Organizador/es:</strong></p>
                    <ul class="list-inline mb-0">
                        {% for item in administradores %}
                            <li class="list-inline-item">{{ item }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Aún no hay administradores definidos para este partido.</p>
                {% endif %}
            </div>
            <div>
                {% if partido.creador %}
                    <p><strong>Creado por:</strong></p>{{ partido.creador }}
                {% endif %}
            </div>
            <div>
                <p><strong>Comunidad:</strong></p>
                <p><a href="{% url 'modric:detalle_comunidad' pk=partido.comunidad.pk %}">
                    <img src="{% if comunidad.escudo %}
                                            {{ comunidad.escudo.url }}
                        {% else %}
                                                /static/modric/escudo.jpg
                        {% endif %}" style="max-height: 20px"> 
                    {{ partido.comunidad }}</a></p>
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Equipo local
                            {% if integrantes_local %}
                                ({{ integrantes_local|length }} / {{ partido.deporte.num_jugadores }})
                            {% else %}
                                (0)
                            {% endif %}
                        </h4>
                        <ul class="card-text">
                            {% if integrantes_local %}
                                {% for item in integrantes_local %}
                                    <div id="ficha-jugador" class="shadow-sm p-2 mb-2 bg-white">
                                        <div>
                                            <img class="card-img-top rounded" src="
                                                {% if item.foto %}
                                                    {{ item.foto.url }}
                                                {% else %}
                                                        /static/accounts/anonimo.jpg
                                                {% endif %}
                                            " alt="Card image {{ item.username }}"
                                                 style="width: 50px; height: 50px; object-fit: cover;">
                                        </div>
                                        <div class="ms-3">
                                            {{ item }}
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <li>No hay jugadores asignados al equipo local.</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Equipo visitante
                            {% if integrantes_visitantes %}
                                ({{ integrantes_visitantes|length }} / {{ partido.deporte.num_jugadores }})
                            {% else %}
                                (0)
                            {% endif %}
                        </h4>
                        <ul class="card-text">
                            {% if integrantes_visitantes %}
                                {% for item in integrantes_visitantes %}
                                    <div id="ficha-jugador" class="shadow-sm p-2 mb-2 bg-white">
                                        <div>
                                            <img class="card-img-top rounded" src="
                                                {% if item.foto %}
                                                    {{ item.foto.url }}
                                                {% else %}
                                                        /static/accounts/anonimo.jpg
                                                {% endif %}
                                            " alt="Card image {{ item.username }}"
                                                 style="width: 50px; height: 50px; object-fit: cover;">
                                        </div>
                                        <div class="ms-3">
                                            {{ item }}
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <li>No hay jugadores asignados al equipo visitante.</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-body">
                <h4 class="card-title">Jugadores apuntados sin equipo
                    {% if sinequipo %}
                        ({{ sinequipo|length }})
                    {% else %}
                        (0)
                    {% endif %}
                </h4>
                <ul class="card-text">
                    {% if sinequipo %}
                        {% for item in sinequipo %}
                            <div id="ficha-jugador" class="shadow-sm p-2 mb-2 bg-white">
                                <div>
                                    <img class="card-img-top rounded" src="
                                        {% if item.foto %}
                                            {{ item.foto.url }}
                                        {% else %}
                                                /static/accounts/anonimo.jpg
                                        {% endif %}
                                    " alt="Card image {{ item.username }}"
                                         style="width: 50px; height: 50px; object-fit: cover;">
                                </div>
                                <div class="ms-3">
                                    {{ item }}
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <li>No hay jugadores sin equipo asignado.</li>
                    {% endif %}
                </ul>
            </div>
        </div>
        
        <hr>
    {% else %}
        <div class="alert alert-danger" role="alert">
            No hay ningún partido con ese identificador.
        </div>
    {% endif %}
    
    {% if apuntable %}
        <div class="mt-4">
            <p>
            {% if inscrito %}
                <form action="{% url 'modric:jugador_partido' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="usuario_id" value="{{ usuario.pk }}">
                    <input type="hidden" name="partido_id" value="{{ partido.id }}">
                    <input type="hidden" name="sentido" value="out">
                    <button type="submit" class="btn btn-danger">Borrarse</button>
                </form>
            {% else %}
                <form action="{% url 'modric:jugador_partido' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="usuario_id" value="{{ usuario.pk }}">
                    <input type="hidden" name="partido_id" value="{{ partido.id }}">
                    <input type="hidden" name="sentido" value="in">
                    <button type="submit" class="btn btn-success">Apuntarse</button>
                </form>
            {% endif %}
    {% else %}
        <div class="card">
            <div class="card-body text-center">
                <h4 class="card-title">Resultado final</h4>
                <div class="alert alert-info" role="alert">
                    {{ partido.get_resultado_estado_display }}
                </div>
                <div class="card-text fs-4 fw-bold">
                    {{ partido.marcador_local }} - {{ partido.marcador_visitante }}
                </div>
            </div>
        </div>
    {% endif %}
    </p>
        <p>
            <a href="{% url 'modric:buscar_partidos' %}" class="btn btn-secondary">Volver a buscar partidos</a>
            <a href="{% url 'modric:ver_partidos' %}" class="btn btn-secondary">Volver a lista de partidos</a>
        </p>
        <p><a href="{% url 'modric:index' %}" class="btn btn-info">Inicio</a></p>
    </div>
</div>
{% endblock %}
