{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Detalle partido</h1>
    
    {% if partido %}
        <div class="mb-3">
            {% if edicion == True %}
                <a href="{% url 'modric:editar_partido' partido.pk %}" class="btn btn-primary">Editar</a>
            {% endif %}
        </div>
        
        <div class="mb-3">
            <strong>Deporte:</strong> {{ partido.deporte }}
        </div>
        <div class="mb-3">
            <strong>Fecha:</strong> {{ partido.fecha|date:"l"|capfirst }}, {{ partido.fecha }}
        </div>
        <div class="mb-3">
            <strong>Duración:</strong> {{ partido.duracion_personalizada }} minutos
        </div>
        <div class="mb-3">
            <strong>Recinto:</strong> <a href="{% url 'modric:recinto' partido.recinto.pk %}">{{ partido.recinto }}</a>
        </div>
        <div class="mb-3">
            {% if partido.nombre_pista %}
                <strong>Número de pista:</strong> {{ partido.nombre_pista }}
            {% endif %}
        </div>
        <div class="mb-3">
            {% if partido.cubierto %}
                <span class="badge bg-success">Pista cubierta</span>
            {% else %}
                <span class="badge bg-warning">Pista al aire libre</span>
            {% endif %}
        </div>
        <hr>
        
        <div class="custom-flex mb-3">
            <div>
                {% if administradores %}
                    <p><strong>Organizador/es:</strong></p>
                    <ul class="list-inline mb-0">
                        {% for item in administradores %}
                            <li class="list-inline-item">{{ item }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Aún no hay administradores definidos para este partido.</p>
                {% endif %}
            </div>
            <div>
                {% if partido.creador %}
                    <p><strong>Creado por:</strong></p>{{ partido.creador }}
                {% endif %}
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Equipo local
                            {% if integrantes_local %}
                                ({{ integrantes_local|length }} / {{ partido.deporte.num_jugadores }})
                            {% else %}
                                (0)
                            {% endif %}
                        </h4>
                        <ul class="card-text">
                            {% if integrantes_local %}
                                {% for item in integrantes_local %}
                                    <li>{{ item }}</li>
                                {% endfor %}
                            {% else %}
                                <li>No hay jugadores asignados al equipo local.</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Equipo visitante
                            {% if integrantes_visitantes %}
                                ({{ integrantes_visitantes|length }} / {{ partido.deporte.num_jugadores }})
                            {% else %}
                                (0)
                            {% endif %}
                        </h4>
                        <ul class="card-text">
                            {% if integrantes_visitantes %}
                                {% for item in integrantes_visitantes %}
                                    <li>{{ item }}</li>
                                {% endfor %}
                            {% else %}
                                <li>No hay jugadores asignados al equipo visitante.</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-body">
                <h4 class="card-title">Jugadores apuntados sin equipo
                    {% if sinequipo %}
                        ({{ sinequipo|length }})
                    {% else %}
                        (0)
                    {% endif %}
                </h4>
                <ul class="card-text">
                    {% if sinequipo %}
                        {% for item in sinequipo %}
                            <li>{{ item }}</li>
                        {% endfor %}
                    {% else %}
                        <li>No hay jugadores sin equipo asignado.</li>
                    {% endif %}
                </ul>
            </div>
        </div>
        
        <hr>
    {% else %}
        <div class="alert alert-danger" role="alert">
            No hay ningún partido con ese identificador.
        </div>
    {% endif %}
    
    {% if apuntable %}
        <div class="mt-4">
            <p>
            {% if inscrito %}
                <form action="{% url 'modric:jugador_partido' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="usuario_id" value="{{ usuario.pk }}">
                    <input type="hidden" name="partido_id" value="{{ partido.id }}">
                    <input type="hidden" name="sentido" value="out">
                    <button type="submit" class="btn btn-danger">Borrarse</button>
                </form>
            {% else %}
                <form action="{% url 'modric:jugador_partido' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="usuario_id" value="{{ usuario.pk }}">
                    <input type="hidden" name="partido_id" value="{{ partido.id }}">
                    <input type="hidden" name="sentido" value="in">
                    <button type="submit" class="btn btn-success">Apuntarse</button>
                </form>
            {% endif %}
    {% endif %}
    </p>
        <p>
            <a href="{% url 'modric:buscar_partidos' %}" class="btn btn-secondary">Volver a buscar partidos</a>
            <a href="{% url 'modric:ver_partidos' %}" class="btn btn-secondary">Volver a lista de partidos</a>
        </p>
        <p><a href="{% url 'modric:index' %}" class="btn btn-info">Inicio</a></p>
    </div>
</div>
{% endblock %}
